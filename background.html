<html>
<head>
</head>
<script type="text/javascript" src="httpRequest.js"></script>
<script>

/**
 * Holds the time between to update request
 *
 * @var int
 */
var requestInterval = 1000 * 6;

/**
 * Function is responsible getting the sttored trac url
 * 
 * @return string - Url from which we need to extract the data
 */
function getRssUrl() {
	var tracRssUrl = localStorage["tracRssUrl"];
	return tracRssUrl;
}

/**
 * Main update function. this function is responsible for fetching
 * the details from the trac url and updating the interface accordingly
 */
function updateTicketCount()
{
	function handleSuccess(xmlDoc) {
		count = xmlDoc.getElementsByTagName('item').length;
		chrome.browserAction.setBadgeText({text: "" + count});
	}

	function handleError() {
		//todo need to put the error handling here
	}

	getData(getRssUrl(), handleSuccess, handleError);
}

/**
 * Main function called when the backgroud page is executed
 * This function register main update function to be called
 * at constant intreval.defined the variable requestIntervals
 * This function also calls the update function for initial 
 * details.
 */
function init()
{
	setInterval(updateTicketCount, requestInterval);
	updateTicketCount();
}
</script>
<body onload="init()">
</body>
</html>