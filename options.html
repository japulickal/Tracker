<html>
<head><title>Trac Chrome Extension</title></head>
<script type="text/javascript">

function validate() {
	var requestInterval = document.getElementById('iRequestInterval').value;

	var integerRegularExpression = /(^\d+$)/; 
	if (!(integerRegularExpression.test(requestInterval))) {
		showErrorMessage('iRequestInterval', 'Interval should a numeric value');
		return false;
	}
	return true;
}

/**
 * Function to save the configurations
 */
function saveConfigurations() {
	if (!validate()) {
		return false;
	}
	var tracRssUrl = document.getElementById("iTracRssUrl").value;
	var requestInterval = document.getElementById('iRequestInterval').value;

	localStorage["tracRssUrl"] = tracRssUrl;
	localStorage["requestInterval"] = requestInterval * 1000;

	// Update status to let user know options were saved.
	var status = document.getElementById("status");
	status.innerHTML = "Options Saved.";
	setTimeout(function() {
		status.innerHTML = "";
	}, 750);

	chrome.extension.getBackgroundPage().update();
}

/**
 * Restore all the configurations values stored
 */
function restoreConfigurations() {
	
	if (localStorage["tracRssUrl"]) {
		document.getElementById("iTracRssUrl").value = 
			localStorage["tracRssUrl"];
	}

	if (localStorage["requestInterval"]) {
		document.getElementById("iRequestInterval").value = 
			localStorage["requestInterval"]/1000;
	}
}

/**
 * Function to show the error message
 */
function showErrorMessage(elementId, errorMessage) {
	// Update status to let user know options were saved.
	var status = document.getElementById("status");
	status.innerHTML = errorMessage;

	setTimeout(function() {
		status.innerHTML = "";
	}, 3000);
}
</script>

<body onload="restoreConfigurations()">
<h1><img src='images/Trac_Logo_48.png' />Trac Chrome Extension</h1>
<div id='status'></div>
<dl>
	<dt>Trac Rss Feed Url :</dt>
	<dd><input type='text' id='iTracRssUrl' name='tracRssUrl' size='80' /></dd>
	<dt>Time Between Request In Seconds :</dt>
	<dd><input type='text' id='iRequestInterval' size='2' /></dd>
</dl>
<button onclick="saveConfigurations()">Save</button>
</body>
</html>